<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Missa Main - Organiza√ß√£o de C√¢nticos</title>
    <link href="https://fonts.googleapis.com/css2?family=Ubuntu+Mono:wght@400;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Ubuntu Mono', monospace;
            background: linear-gradient(135deg, #000000 0%, #2c2c2c 25%, #4a4a4a 50%, #c0c0c0 75%, #ffffff 100%);
            min-height: 100vh;
            color: #ffffff;
            overflow-x: hidden;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 20px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }

        .header h1 {
            font-size: 2.5rem;
            color: #ffff00;
            text-shadow: 0 0 20px #ffff00;
            margin-bottom: 10px;
        }

        .search-container {
            margin: 20px 0;
            position: relative;
        }

        .search-input {
            width: 100%;
            padding: 15px 20px;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 15px;
            color: #ffffff;
            font-family: 'Ubuntu Mono', monospace;
            font-size: 1rem;
            outline: none;
            transition: all 0.3s ease;
        }

        .search-input:focus {
            border-color: #ffff00;
            box-shadow: 0 0 20px rgba(255, 255, 0, 0.3);
        }

        .search-input::placeholder {
            color: rgba(255, 255, 255, 0.7);
        }

        .search-results {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: rgba(0, 0, 0, 0.9);
            backdrop-filter: blur(15px);
            border-radius: 15px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            max-height: 300px;
            overflow-y: auto;
            z-index: 1000;
            display: none;
        }

        .search-result-item {
            padding: 10px 15px;
            cursor: pointer;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            transition: background 0.3s ease;
        }

        .search-result-item:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .main-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 20px;
            margin-bottom: 30px;
        }

        .sections-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }

        .section-card {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(15px);
            border-radius: 20px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            overflow: hidden;
            transition: all 0.3s ease;
        }

        .section-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 40px rgba(0, 0, 0, 0.4);
        }

        .section-header {
            padding: 20px;
            background: rgba(255, 255, 255, 0.05);
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .section-title {
            font-size: 1.2rem;
            font-weight: 700;
            color: #ffffff;
            text-shadow: 0 0 10px rgba(255, 255, 255, 0.5);
        }

        .section-toggle {
            font-size: 1.5rem;
            color: #ffff00;
            transition: transform 0.3s ease;
        }

        .section-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease;
        }

        .section-content.expanded {
            max-height: 400px;
            overflow-y: auto;
        }

        .song-item {
            padding: 15px 20px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
            transition: all 0.3s ease;
            draggable: true;
        }

        .song-item:hover {
            background: rgba(255, 255, 255, 0.1);
            transform: translateX(5px);
        }

        .song-name {
            flex: 1;
            color: #ffffff;
            font-size: 0.9rem;
        }

        .add-btn {
            background: rgba(255, 255, 0, 0.2);
            border: 1px solid #ffff00;
            color: #ffff00;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: bold;
        }

        .add-btn:hover {
            background: #ffff00;
            color: #000000;
            transform: scale(1.1);
        }

        .missa-hoje-toggle {
            position: fixed;
            bottom: 30px;
            right: 30px;
            width: 60px;
            height: 60px;
            background: rgba(255, 255, 0, 0.9);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 2rem;
            color: #000000;
            box-shadow: 0 8px 32px rgba(255, 255, 0, 0.5);
            transition: all 0.3s ease;
            z-index: 1001;
        }

        .missa-hoje-toggle:hover {
            transform: scale(1.1);
            box-shadow: 0 12px 40px rgba(255, 255, 0, 0.7);
        }

        .missa-hoje {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(15px);
            border-radius: 20px;
            border: 2px solid rgba(255, 255, 0, 0.5);
            box-shadow: 0 8px 32px rgba(255, 255, 0, 0.2);
            padding: 20px;
            width: 90vw;
            max-width: 500px;
            max-height: 80vh;
            z-index: 1002;
            display: none;
        }

        .missa-hoje.visible {
            display: block;
        }

        .missa-hoje h2 {
            color: #ffff00;
            text-align: center;
            margin-bottom: 20px;
            font-size: 1.5rem;
            text-shadow: 0 0 15px #ffff00;
        }

        .missa-list {
            min-height: 200px;
            border: 2px dashed rgba(255, 255, 255, 0.3);
            border-radius: 15px;
            padding: 15px;
            margin-bottom: 20px;
            background: rgba(0, 0, 0, 0.2);
            max-height: 300px;
            overflow-y: auto;
        }

        .missa-item {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 10px;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .missa-item .remove-btn {
            background: rgba(255, 0, 0, 0.3);
            border: 1px solid #ff0000;
            color: #ff0000;
            width: 25px;
            height: 25px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .missa-item .remove-btn:hover {
            background: #ff0000;
            color: #ffffff;
        }

        .control-buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .control-btn {
            flex: 1;
            padding: 12px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 10px;
            color: #ffffff;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: 'Ubuntu Mono', monospace;
            font-size: 0.9rem;
            min-width: 80px;
        }

        .control-btn:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateY(-2px);
        }

        .control-btn.save {
            border-color: #00ff00;
            color: #00ff00;
        }

        .control-btn.clear {
            border-color: #ff0000;
            color: #ff0000;
        }

        .control-btn.load {
            border-color: #00ffff;
            color: #00ffff;
        }

        .popup-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 2000;
        }

        .popup-content {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            border: 1px solid rgba(255, 255, 255, 0.3);
            padding: 20px;
            max-width: 90vw;
            max-height: 90vh;
            overflow: auto;
            position: relative;
        }

        .popup-close {
            position: absolute;
            top: 15px;
            right: 20px;
            background: rgba(255, 0, 0, 0.3);
            border: 1px solid #ff0000;
            color: #ff0000;
            width: 35px;
            height: 35px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 1.2rem;
            transition: all 0.3s ease;
        }

        .popup-close:hover {
            background: #ff0000;
            color: #ffffff;
        }

        .pdf-viewer {
            width: 100%;
            height: 70vh;
            border: none;
            border-radius: 10px;
        }

        /* Responsividade */
        @media (max-width: 768px) {
            .main-grid {
                grid-template-columns: 1fr;
            }

            .sections-container {
                grid-template-columns: 1fr;
            }

            .header h1 {
                font-size: 2rem;
            }

            .control-buttons {
                flex-direction: column;
            }

            .control-btn {
                min-width: auto;
            }

            .missa-hoje {
                width: 95vw;
                max-height: 85vh;
            }
        }

        @media (max-width: 480px) {
            .container {
                padding: 10px;
            }

            .header h1 {
                font-size: 1.5rem;
            }

            .section-title {
                font-size: 1rem;
            }

            .song-name {
                font-size: 0.8rem;
            }
        }

        /* Anima√ß√µes */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .section-card {
            animation: fadeIn 0.5s ease forwards;
        }

        /* Drag and Drop */
        .dragging {
            opacity: 0.5;
            transform: rotate(5deg);
        }

        .drop-zone {
            border-color: #ffff00 !important;
            background: rgba(255, 255, 0, 0.1) !important;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üéµ Missa Main</h1>
            <p>Organiza√ß√£o de C√¢nticos Lit√∫rgicos</p>
        </div>

        <div class="search-container">
            <input type="text" class="search-input" placeholder="Pesquisar c√¢nticos por trechos da letra..." id="searchInput">
            <div class="search-results" id="searchResults"></div>
        </div>

        <div class="main-grid">
            <div class="sections-container" id="sectionsContainer">
                <!-- Se√ß√µes ser√£o geradas dinamicamente -->
            </div>
        </div>
    </div>

    <!-- Bot√£o flutuante para abrir Missa de Hoje -->
    <div class="missa-hoje-toggle" id="missaHojeToggle" onclick="toggleMissaHoje()">
        üôè
    </div>

    <!-- Quadro Missa de Hoje (impl√≠cito) -->
    <div class="missa-hoje" id="missaHoje">
        <h2>üôè Missa de Hoje</h2>
        <div class="missa-list" id="missaList">
            <p style="text-align: center; color: rgba(255,255,255,0.7); font-style: italic;">
                Arraste os c√¢nticos aqui para organizar a missa
            </p>
        </div>
        <div class="control-buttons">
            <button class="control-btn save" onclick="saveMissa()">üíæ Salvar</button>
            <button class="control-btn clear" onclick="clearMissa()">üóëÔ∏è Limpar</button>
            <button class="control-btn load" onclick="loadMissa()">üìÇ Carregar</button>
        </div>
    </div>

    <!-- Popup para visualiza√ß√£o de PDF -->
    <div class="popup-overlay" id="popupOverlay">
        <div class="popup-content">
            <div class="popup-close" onclick="closePopup()">√ó</div>
            <iframe class="pdf-viewer" id="pdfViewer"></iframe>
        </div>
    </div>

    <script>
        // Estrutura das se√ß√µes na ordem da missa
        const sections = [
            { id: '1 - Entrada', name: 'üö™ Entrada', order: 1 },
            { id: '2 - Ato penitencial', name: 'üôè Ato Penitencial', order: 2 },
            { id: '3 - Gloria', name: '‚ú® Gl√≥ria', order: 3 },
            { id: '4 - Aclama√ß√£o ao evangelho', name: 'üìñ Aclama√ß√£o ao Evangelho', order: 4 },
            { id: '5 - Ofert√≥rio', name: 'üçû Ofert√≥rio', order: 5 },
            { id: '6 - Santo', name: 'üëº Santo', order: 6 },
            { id: '7 - Comunh√£o', name: 'üç∑ Comunh√£o', order: 7 },
            { id: '8 - A√ß√£o de Gra√ßas', name: 'üôå A√ß√£o de Gra√ßas', order: 8 },
            { id: '9 - Final', name: 'üö™ Final', order: 9 },
            { id: '10 - Abra√ßo de Paz', name: 'ü§ù Abra√ßo de Paz', order: 10 },
            { id: '15 - Abra√ßo de Paz', name: 'ü§ù Abra√ßo de Paz (Alt)', order: 11 },
            { id: '16 - Cordeiro', name: 'üêë Cordeiro', order: 12 },
            { id: '11 - Canticos Marianos', name: 'üë∏ C√¢nticos Marianos', order: 13 },
            { id: '12 - Louvor e medita√ß√£o', name: 'üéµ Louvor e Medita√ß√£o', order: 14 },
            { id: '13 - Diversos', name: 'üéº Diversos', order: 15 },
            { id: '14 - Salmos', name: 'üìú Salmos', order: 16 }
        ];

        // Base URL do GitHub para acessar os PDFs
        const baseUrl = 'https://github.com/iramalho1980/missa_main/raw/main/Letras/';

        // Dados dos c√¢nticos (carregados dinamicamente)
        const songData = {
            "1 - Entrada": [
                "Entrada - Eu e Minha Casa Serviremos ao Senhor",
                "a_biblia_e_a_palavra_de_deus",
                "bom_pastor",
                "cora√ß√£o_santo",
                "cristo_ressucitou_aleluia",
                "deixa_a_luz_do_ceu_entrar",
                "eis_me_aqui_senhor",
                "esatremos_aqui_reunidos",
                "faco_novas_todas_as_coisas",
                "hosana_hey_hosana_ha",
                "por_entre_aclama√ß√µes",
                "por_sua_morte",
                "porque_ele_vive",
                "senhor_quem_entrara",
                "te_amarei",
                "toda_biblia_e_comunicacao",
                "tu_es_a_razao_da_jornada",
                "vem_louvar"
            ],
            "2 - Ato penitencial": [
                "Ato Penitencial - Senhor, Piedade",
                "conheco_um_coracao",
                "coracoes_arrependidos",
                "kyrie_eleison_jmj",
                "pelos_pecados_senhor_piedade_de_nos",
                "perdao_senhor",
                "renovame",
                "renovame_ii",
                "senhor_que_viestes_salvar_kirie_elleisson",
                "senhor_tende_piedade_de_nos",
                "senhor_tende_piedade_perdoai_nossa_culpa"
            ],
            "3 - Gloria": [
                "Gl√≥ria - Eliana Ribeiro",
                "a_ele_seja_a_gloria",
                "gloria_a_deus_nas_alturas",
                "gloria_a_deus_nas_alturas__rock_balada",
                "gloria_ao_pai_criador"
            ],
            "4 - Aclama√ß√£o ao evangelho": [
                "a_minhalma_abrirei",
                "a_vossa_palavra_senhor",
                "aleluia_como_o_pai_me_amou",
                "buscai_primeiro_o_reino_de_deus",
                "como_sao_belos",
                "eu_vim_para_escutar",
                "palavra_de_salvacao",
                "quando_estamos_unidos",
                "que_alegria_cristo_ressurgiu",
                "vai_falar_no_evangelho",
                "vinde_espirito_de_deus"
            ],
            "5 - Ofert√≥rio": [
                "a_mesa_santa_que_preparamos",
                "de_maos_estendidas",
                "meu_coracao_eh_para_ti",
                "minha_vida_tem_sentido",
                "muitos_graos_de_trigo",
                "ofertas_singelas",
                "sabes_senhor",
                "um_coracao_para_amar"
            ],
            "6 - Santo": [
                "hosana_eh",
                "hosana_no_alto_ceu",
                "o_senhor_eh_santo",
                "santo_santo_e",
                "senhor_deus_do_universo"
            ],
            "7 - Comunh√£o": [
                "a_barca",
                "a_ti_meu_deus",
                "antes_da_morte_e_ressurreicao",
                "cantar_a_beleza_da_vida",
                "como_es_lindo",
                "conhe√ßo_um_cora√ß√£o",
                "da_cepa_brotou_a_rama",
                "desamarrem_as_sandalias",
                "estas_entre_nos",
                "este_pranto_em_minhas_maos",
                "eu_navegarei",
                "eu_quis_comer_esta_ceia_agora",
                "eu_vim_para_que_todos_tenham_vida",
                "pelos_prados",
                "procuro_abrigo_nos_coracoes",
                "quando_teu_pai_revelou",
                "quem_nos_separara",
                "sacramento_da_comunhao",
                "sim_eu_quero",
                "sonda_me",
                "vem_eu_mostrarei",
                "vou_cantar_teu_amor"
            ],
            "8 - A√ß√£o de Gra√ßas": [
                "deus_esta_aqui",
                "e_impossivel_nao_crer_em_ti",
                "espirito_santo",
                "obrigado_senhor"
            ],
            "9 - Final": [
                "a_alegria_esta_no_coracao",
                "como_o_pai_me_enviou",
                "cristo_eh_a_felicidade",
                "deixa_luz_do_ceu_entrar",
                "hoje_e_tempo_de_louvar",
                "pelas_estradas_da_vida",
                "segura_na_mao_de_deus",
                "tomado_pela_mao",
                "tu_es_razao_jornada"
            ],
            "10 - Abra√ßo de Paz": [
                "esteja_sempre_com_voce",
                "irmao_minha_paz_eu_te_dou",
                "paz_paz_de_cristo"
            ],
            "15 - Abra√ßo de Paz": [
                "quero_te_dar_a_paz"
            ],
            "16 - Cordeiro": [
                "cordeiro_de_deus"
            ],
            "11 - Canticos Marianos": [
                "a_escolhida",
                "ave_cheia_de_graca",
                "imaculada_maria_de_deus",
                "maria_de_nazare",
                "santa_mae_maria",
                "santa_maria_vem"
            ],
            "12 - Louvor e medita√ß√£o": [
                "Desamarrem_as_sand√°lias",
                "a_alegria_esta_no_coracao",
                "a_nos_descei_divina_luz",
                "agua_viva",
                "amar_como_jesus_amou",
                "bate_o_sino",
                "eu_louvarei",
                "eu_quero_um_rio",
                "louvado_seja_o_meu_senhor",
                "meu_mestre__a_minha_vida_e_do_mestre",
                "noite_feliz",
                "noites_traicoeiras",
                "oracao_da_familia",
                "oracao_de_sao_francisco",
                "podes_reinar",
                "quao_grande_es_tu",
                "segura_na_mao_de_deus",
                "tao_sublime",
                "vou-cantar-teu-amor"
            ],
            "13 - Diversos": [
                "Consagra√ß√£o a nossa senhora",
                "podes_reinar",
                "prova_de_amor",
                "tudo_e_do_pai"
            ],
            "14 - Salmos": [
                "salmo 137"
            ]
        };

        // Inicializar a aplica√ß√£o
        document.addEventListener('DOMContentLoaded', function() {
            generateSections();
            setupEventListeners();
        });

        function generateSections() {
            const container = document.getElementById('sectionsContainer');
            
            sections.sort((a, b) => a.order - b.order).forEach(section => {
                const sectionCard = document.createElement('div');
                sectionCard.className = 'section-card';
                sectionCard.innerHTML = `
                    <div class="section-header" onclick="toggleSection('${section.id}')">
                        <div class="section-title">${section.name}</div>
                        <div class="section-toggle" id="toggle-${section.id}">‚ñº</div>
                    </div>
                    <div class="section-content" id="content-${section.id}">
                        <div id="songs-${section.id}">
                            <div style="padding: 20px; text-align: center; color: rgba(255,255,255,0.7);">
                                Carregando c√¢nticos...
                            </div>
                        </div>
                    </div>
                `;
                container.appendChild(sectionCard);
            });
        }

        function toggleSection(sectionId) {
            const content = document.getElementById(`content-${sectionId}`);
            const toggle = document.getElementById(`toggle-${sectionId}`);
            
            if (content.classList.contains('expanded')) {
                content.classList.remove('expanded');
                toggle.textContent = '‚ñº';
            } else {
                content.classList.add('expanded');
                toggle.textContent = '‚ñ≤';
                loadSongsForSection(sectionId);
            }
        }

        function loadSongsForSection(sectionId) {
            const songsContainer = document.getElementById(`songs-${sectionId}`);
            const songs = songData[sectionId] || [];
            
            if (songs.length === 0) {
                songsContainer.innerHTML = `
                    <div style="padding: 20px; text-align: center; color: rgba(255,255,255,0.7);">
                        Nenhum c√¢ntico encontrado nesta se√ß√£o
                    </div>
                `;
                return;
            }

            songsContainer.innerHTML = songs.map(song => `
                <div class="song-item" draggable="true" ondragstart="dragStart(event)" data-song="${song}" data-section="${sectionId}">
                    <div class="song-name" onclick="openPDF('${sectionId}', '${song}')">${song.replace(/_/g, ' ')}</div>
                    <div class="add-btn" onclick="addToMissa('${song}', '${sectionId}')">+</div>
                </div>
            `).join('');
        }

        function openPDF(sectionId, songName) {
            // Construir URL do PDF
            const pdfUrl = `${baseUrl}${encodeURIComponent(sectionId)}/${encodeURIComponent(songName)}.pdf`;
            
            // Abrir popup com PDF
            document.getElementById('pdfViewer').src = pdfUrl;
            document.getElementById('popupOverlay').style.display = 'flex';
        }

        function closePopup() {
            document.getElementById('popupOverlay').style.display = 'none';
            document.getElementById('pdfViewer').src = '';
        }

        function toggleMissaHoje() {
            const missaHoje = document.getElementById('missaHoje');
            missaHoje.classList.toggle('visible');
        }

        function addToMissa(songName, sectionId) {
            const missaList = document.getElementById('missaList');
            
            // Remover mensagem de placeholder se existir
            const placeholder = missaList.querySelector('p');
            if (placeholder) {
                placeholder.remove();
            }

            // Criar item da missa
            const missaItem = document.createElement('div');
            missaItem.className = 'missa-item';
            missaItem.innerHTML = `
                <div onclick="openPDF('${sectionId}', '${songName}')" style="cursor: pointer; flex: 1;">
                    ${songName.replace(/_/g, ' ')}
                </div>
                <div class="remove-btn" onclick="removeFromMissa(this)">√ó</div>
            `;
            
            missaList.appendChild(missaItem);
        }

        function removeFromMissa(button) {
            button.parentElement.remove();
            
            // Se n√£o h√° mais itens, mostrar placeholder
            const missaList = document.getElementById('missaList');
            if (missaList.children.length === 0) {
                missaList.innerHTML = `
                    <p style="text-align: center; color: rgba(255,255,255,0.7); font-style: italic;">
                        Arraste os c√¢nticos aqui para organizar a missa
                    </p>
                `;
            }
        }

        function saveMissa() {
            const missaItems = Array.from(document.querySelectorAll('.missa-item')).map(item => {
                const text = item.querySelector('div').textContent.trim();
                return text;
            });
            
            localStorage.setItem('missaAtual', JSON.stringify(missaItems));
            alert('Missa salva com sucesso!');
        }

        function clearMissa() {
            if (confirm('Tem certeza que deseja limpar a missa atual?')) {
                document.getElementById('missaList').innerHTML = `
                    <p style="text-align: center; color: rgba(255,255,255,0.7); font-style: italic;">
                        Arraste os c√¢nticos aqui para organizar a missa
                    </p>
                `;
            }
        }

        function loadMissa() {
            const savedMissa = localStorage.getItem('missaAtual');
            if (savedMissa) {
                const missaItems = JSON.parse(savedMissa);
                const missaList = document.getElementById('missaList');
                
                missaList.innerHTML = '';
                
                missaItems.forEach(songName => {
                    const missaItem = document.createElement('div');
                    missaItem.className = 'missa-item';
                    missaItem.innerHTML = `
                        <div onclick="openPDF('', '${songName}')" style="cursor: pointer; flex: 1;">
                            ${songName}
                        </div>
                        <div class="remove-btn" onclick="removeFromMissa(this)">√ó</div>
                    `;
                    missaList.appendChild(missaItem);
                });
                
                alert('Missa carregada com sucesso!');
            } else {
                alert('Nenhuma missa salva encontrada.');
            }
        }

        function setupEventListeners() {
            // Pesquisa
            const searchInput = document.getElementById('searchInput');
            const searchResults = document.getElementById('searchResults');
            
            searchInput.addEventListener('input', function() {
                const query = this.value.toLowerCase().trim();
                
                if (query.length < 2) {
                    searchResults.style.display = 'none';
                    return;
                }
                
                // Buscar por trechos de letra
                const results = [];
                Object.keys(songData).forEach(sectionId => {
                    songData[sectionId].forEach(song => {
                        if (song.toLowerCase().includes(query)) {
                            results.push({ song, sectionId });
                        }
                    });
                });
                
                if (results.length > 0) {
                    searchResults.innerHTML = results.map(result => `
                        <div class="search-result-item" onclick="openPDF('${result.sectionId}', '${result.song}')">
                            ${result.song.replace(/_/g, ' ')} <small>(${result.sectionId})</small>
                        </div>
                    `).join('');
                    searchResults.style.display = 'block';
                } else {
                    searchResults.innerHTML = '<div class="search-result-item">Nenhum resultado encontrado</div>';
                    searchResults.style.display = 'block';
                }
            });
            
            // Fechar resultados de pesquisa ao clicar fora
            document.addEventListener('click', function(e) {
                if (!searchInput.contains(e.target) && !searchResults.contains(e.target)) {
                    searchResults.style.display = 'none';
                }
            });
            
            // Drag and Drop
            const missaList = document.getElementById('missaList');
            
            missaList.addEventListener('dragover', function(e) {
                e.preventDefault();
                this.classList.add('drop-zone');
            });
            
            missaList.addEventListener('dragleave', function(e) {
                if (!this.contains(e.relatedTarget)) {
                    this.classList.remove('drop-zone');
                }
            });
            
            missaList.addEventListener('drop', function(e) {
                e.preventDefault();
                this.classList.remove('drop-zone');
                
                const songName = e.dataTransfer.getData('text/song');
                const sectionId = e.dataTransfer.getData('text/section');
                
                if (songName && sectionId) {
                    addToMissa(songName, sectionId);
                }
            });

            // Fechar Missa de Hoje ao clicar fora
            document.addEventListener('click', function(e) {
                const missaHoje = document.getElementById('missaHoje');
                const missaToggle = document.getElementById('missaHojeToggle');
                
                if (missaHoje.classList.contains('visible') && 
                    !missaHoje.contains(e.target) && 
                    !missaToggle.contains(e.target)) {
                    missaHoje.classList.remove('visible');
                }
            });
        }

        function dragStart(e) {
            e.target.classList.add('dragging');
            e.dataTransfer.setData('text/song', e.target.dataset.song);
            e.dataTransfer.setData('text/section', e.target.dataset.section);
            
            setTimeout(() => {
                e.target.classList.remove('dragging');
            }, 0);
        }

        // Fechar popup ao clicar fora
        document.getElementById('popupOverlay').addEventListener('click', function(e) {
            if (e.target === this) {
                closePopup();
            }
        });
    </script>
</body>
</html>

